<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .navbar { background: linear-gradient(135deg, #4a47a3, #6a64c4); }
    .navbar-brand { font-weight: bold; color: #fff !important; }
    .nav-link { color: #fff !important; }
    .nav-link.active { font-weight: bold; text-decoration: underline; }
    .dashboard-container { margin-top: 80px; }
    .card { border-radius: 15px; box-shadow: 0px 6px 15px rgba(0,0,0,0.1); }
    .table thead { background-color: #4a47a3; color: white; }
    .btn-action { border-radius: 25px; font-size: 13px; padding: 6px 16px; font-weight: 500; transition: all 0.3s ease; }
    .btn-view { background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; }
    .btn-view:hover { background: linear-gradient(135deg, #0056b3, #00408a); transform: scale(1.05); }
    .btn-download { background: linear-gradient(135deg, #28a745, #1e7e34); color: white; border: none; }
    .btn-download:hover { background: linear-gradient(135deg, #1e7e34, #145523); transform: scale(1.05); }
    .btn-group-custom { display: flex; gap: 10px; justify-content: center; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">User Profile Collector</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="/admin">Admin</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container dashboard-container">
    <div class="card p-4">
      <h2 class="text-center text-primary mb-4">Registered User Profiles</h2>
      
      <!-- üîç Search Bar -->
      <div class="d-flex justify-content-end mb-3">
        <form method="get" action="/admin" class="d-flex">
          <input type="text" name="search" value="{{ search_query }}" class="form-control me-2" placeholder="üîç Search...">
          <button type="submit" class="btn btn-primary">Search</button>
        </form>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle text-center">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Age</th>
              <th>Gender</th>
              <th>College</th>
              <th>CGPA</th>
              <th>Skills</th>
              <th>Bio</th>
              <th>Resume</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for p in profiles %}
            <tr>
              <td>{{ p.id }}</td>
              <td>{{ p.name }}</td>
              <td>{{ p.email }}</td>
              <td>{{ p.age }}</td>
              <td>{{ p.gender }}</td>
              <td>{{ p.college }}</td>
              <td>{{ p.cgpa }}</td>
              <td>{{ p.skills }}</td>
              <td>{{ p.bio }}</td>
              <td>
                <div class="btn-group-custom">
                  <a href="/resume/{{ p.resume_path }}" target="_blank" class="btn btn-sm btn-view btn-action">üëÅ View</a>
                  <a href="/resume/{{ p.resume_path }}" download class="btn btn-sm btn-download btn-action">‚¨á Download</a>
                </div>
              </td>
              <td>
                <a href="/edit/{{ p.id }}" class="btn btn-sm btn-warning btn-action">‚úè Edit</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- üî¥ Delete Selected (Dropdown) -->
      <div class="mt-3">
        <form action="/delete_selected" method="POST" 
              onsubmit="return confirm('‚ö†Ô∏è Are you sure you want to delete this record?');">
          <label class="form-label fw-bold">Delete a Profile (Select from dropdown)</label>
          <div class="input-group">
            <select name="profile_id" class="form-select form-select-sm" required>
              {% for p in profiles %}
                <option value="{{ p.id }}">{{ p.name }} - {{ p.email }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="btn btn-sm btn-danger">üóë Delete</button>
          </div>
        </form>
      </div>

      <!-- üî¥ Delete All Button -->
      <div class="text-center mt-3">
        <form action="/delete_all" method="POST" 
              onsubmit="return confirm('‚ö†Ô∏è Are you sure you want to delete ALL records and resumes? This cannot be undone.');">
          <button type="submit" class="btn btn-danger">üóë Delete All Data</button>
        </form>
      </div>
    </div>
  </div>

</body>
</html>
